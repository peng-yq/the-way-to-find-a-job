## 死锁

构成死锁需**同时满足的4个条件**：

- 互斥条件
- 持有并等待
- 不可剥夺
- 环路等待

通过一个例子来说明上述4个条件，进程A需要资源1和资源2才能完成任务，而进程B也需要资源1和资源2才能完成任务；若此时进程A持有资源1，需要资源2，进程B持有资源2，需要资源1，A和B构成死锁。

**互斥条件**：资源1和资源2在同一时刻都只能由一个进程获取
**持有并等待**：进程A持有资源1，等待资源2，不完成任务前不退出；进程B同理
**不可剥夺**：资源1在进程A完成前不可剥夺
**环路等待**：进程A和进程B构成环路

## 利用工具排查死锁问题

排查死锁可以通过代码审查，C/C++可以使用GDB的调试功能，你可以在运行时检查线程的状态和锁的持有情况。虽然它不自动检测死锁，但你可以手动查看锁的持有者和等待这些锁的线程。使用info threads查看所有线程，thread <n>切换到特定线程，info lock查看锁的状态。

## 避免死锁问题的产生

避免死锁问题的产生，只需要破坏上面的4个条件之一即可，最常用的是使用**资源有序分配来破坏环路等待条件**。也就是进程A和进程B都先获取资源1再获取资源2。