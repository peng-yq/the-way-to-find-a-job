一些和现代c++关联不大的c++知识（只是突然想回忆一下

C++程序的构建过程通常分为四个主要阶段：**预处理、编译、汇编和链接**：

- 预处理：预处理器（cpp）接收C++源代码作为输入，**处理源代码文件中以#开头的预处理指令**，这包括宏定义的展开（#define）、条件编译指令（如#ifdef、#ifndef、#endif）以及包含头文件的指令（#include）。`g++ -E`
- 编译：由编译器（如g++或clang++）处理。在这个阶段，编译器将**预处理后的源代码转换成汇编语言代码**。`g++ -S`
- 汇编：由汇编器（如as）处理。汇编器将**编译阶段生成的汇编语言代码转换成机器语言指令，通常是目标代码（object code）**。这些目标代码是以二进制形式表示的，但在这个阶段，代码还不能直接运行，因为它可能还依赖于其他的目标文件或库。`g++ -C`
- 汇编：由链接器（如ld）处理。在这个阶段，链接器**将一个或多个目标文件以及必要的库文件合并成一个单一的可执行文件**。`g++`

g++和gcc都是GNU编译器套件（GNU Compiler Collection，GCC）的一部分：

- g++ 是专门用于编译C++代码的编译器前端。它自动链接C++程序所需的C++标准库，比如libstdc++。当你使用g++编译C++代码时，不需要显式指定链接这些库。
- gcc 最初是作为GNU C编译器开发的，用于编译C语言代码。随着时间的推移，它成为了一个多语言编译器前端，可以通过不同的前端来支持多种编程语言，包括C、C++、Objective-C、Fortran、Ada等。

**gcc命令也可以用来编译C++文件，需要显式地添加-lstdc++标志来链接C++标准库**，否则在链接时可能会出现未定义的引用错误。但通常推荐使用g++来编译C++程序，因为g++会自动处理一些C++特定的编译和链接步骤，使得编译过程更加简洁和直接。

```shell
gcc example.cpp -lstdc++ -o example
```
## 迈向现代C++

C++不是C的超集。

在编写 C++ 时，也应该尽可能的避免使用诸如 void* 之类的程序风格。而在不得不使用 C 时，应该注意使用 extern "C" 这种特性（确保当这个头文件被C++代码包含时，以C语言的链接方式进行编译），将 C 语言的代码与 C++代码进行分离编译，再统一链接。

```c
// foo.h
#ifdef __cplusplus
extern "C" {
#endif

int add(int x, int y);

#ifdef __cplusplus
}
#endif
```

用两个条件编译指令是因为只有在c++编译过程中才需要extern "C"

```shell
gcc -c foo.c
# 再和c++文件一起链接
```